<link
  rel="stylesheet"
  href="https://site-assets.fontawesome.com/releases/v6.5.2/css/all.css"
/>
<!-- <div class="cartTransparent-BackGround"></div> -->
<!-- cart items -->
<div class="Cart-Products-Div">
  <section class="BagArrow">
    <h1><a href="/index.html">&#8592;</a> Bag</h1>
    <!-- <p>View Wishlist</p> -->
  </section>

  <section class="BagEmpty-Part">
    <div><img src="/images/emptyCartImg.png" alt="" /></div>
    <button class="StartShopping">Start Shopping</button>
  </section>

  <section class="BagNon-EmptySection">
    <div class="products-And-ItsQuantity-BOX"></div>

    <div class="Coupons">
      <div class="appalyCoupn-Part">
        <p><b>Coupons</b></p>
        <p class="pinkColor-ApplyNow">Apply now and save extra!</p>
      </div>
      <div class="GtArrow">&gt;</div>
    </div>

    <div class="PriceDetails"></div>

    <div class="Total-And-Proceed">
      <div class="total">
        <h2 class="totalsH2"></h2>
        <p>Grand Total</p>
      </div>
      <button class="orderPlaced">Proceed <span> &#8594;</span></button>
    </div>
  </section>
</div>

<!-- styles -->
<style>
  body {
    margin: 0;
    font-family: "Inter", sans-serif;
  }

  .Cart-Products-Div {
    box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
    position: absolute;
    top: 0;
    right: 0px;
    width: 350px;
    height: 100vh;
    background-color: white;
    z-index: 600;
    padding: 0px 15px;
  }

  .BagArrow {
    /* border-bottom: 1px solid; */
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0px 12px;
    font-size: 14px;
  }
  .BagArrow > h1 > a {
    text-decoration: none;
    color: black;
  }
  .BagArrow > h1 > a:hover {
    color: #f8469c;
  }
  .BagEmpty-Part {
    /* border: 1px solid red; */
    margin-top: 20%;
    /* display: none; */
    margin: auto;
  }

  .BagEmpty-Part > div {
    /* border: 1px solid green; */
    width: 300px;
    margin: auto;
  }
  .BagEmpty-Part > div > img {
    width: 100%;
    object-fit: contain;
  }

  .BagEmpty-Part button {
    display: block;
    margin: auto;
    margin-top: 20px;
  }
  /* BagNon-EmptySection will appear when there is item in the bag */
  .BagNon-EmptySection {
    width: 100%;
    height: 80%;
    display: grid;
    grid-template-rows: auto 10% 40% auto;
    gap: 15px;
    overflow: auto;
    display: none;
  }
  .BagNon-EmptySection > div {
    /* display: none; */
    border: 1px solid #f0f0f2;
    border-radius: 5px;
    padding: 4px;
  }
  .BagNon-EmptySection .products-And-ItsQuantity-BOX {
    border: none;
  }
  .products-And-ItsQuantity-BOX > div {
    /* border: 1px solid red; */
    border: 1px solid #f0f0f2;
    margin-top: 7px;
    padding: 5px;
    border-radius: 5px;
  }
  /* img-nameDetails */
  .img-nameDetails,
  .qnt-price {
    /* border: 1px dotted blue; */
    height: 100px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
  }
  .img-nameDetails img {
    /* border: 1px dotted red; */
    width: 80px;
    object-fit: contain;
  }
  .nameDetails {
    /* border: 1px dotted green; */
    position: relative;
  }
  .nameDetails h6,
  p {
    margin: 2px;
    font-size: 10px;
  }
  .nameDetails h6 {
    font-size: 14px;
    font-weight: 300;
    width: 80%;
  }
  .delete {
    position: absolute;
    top: 0;
    right: 1px;
    cursor: pointer;
  }
  .delete:hover {
    transform: scale(0.9);
  }
  .qnt-price {
    height: 40px;
    align-items: center;
  }
  .qnt-price select {
    border: none;
  }
  .previous-price {
    opacity: 0.5;
    text-decoration: line-through;
  }
  /* Coupons */
  .Coupons {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 20px 0px 20px 0px;
  }

  .pinkColor-ApplyNow {
    color: #e8298e;
  }
  .GtArrow {
    font-weight: bolder;
    font-size: 23px;
  }
  .StartShopping {
    width: 60%;
    padding: 15px 20px;
    border: none;
    background-color: #e80071;
    color: white;
    font-weight: bold;
    border-radius: 10px;
    margin-top: 10px;
    cursor: pointer;
    background-color: #f8469c;
  }
  .PriceDetails > h2 {
    /* border: 1px solid blue; */
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin: 0;
    font-weight: 500;
    font-size: 19px;
    padding: 5px;
  }
  .PriceDetails > div {
    /* border: 1px solid green; */
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 5px;
  }
  .PriceDetails > div > h2 {
    margin: 0;
    font-weight: 500;
    font-size: 17px;
  }
  .Cart-Products-Div .Total-And-Proceed {
    /* border: 1px solid; */
    width: 320px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 50px;
    /* margin-left: 1%; */
    border: none;
  }
  .total,
  .Total-And-Proceed button {
    position: absolute;
  }
  .Total-And-Proceed button {
    right: 0;
  }
  .total {
    left: 0;
  }

  .total h2,
  p {
    margin: 0;
    font-weight: 400;
  }

  .Total-And-Proceed button {
    width: 55%;
    border: none;
    color: white;
    font-weight: bold;
    background-color: #e80071;
    padding: 10px 20px;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
  }
  .Total-And-Proceed button > span {
    font-size: 20px;
    margin: 0;
    padding: 0;
  }
  .Total-And-Proceed button:hover {
    transform: scale(0.95);
    transition: 0.15s ease-in-out;
  }
  .StartShopping:hover {
    transform: scale(0.99);
  }

  @media screen and (max-width: 380px) {
    .Cart-Products-Div {
      width: 100%;
      height: 100vh;
      padding: 0;
    }
  }
</style>

<!-- let LoggedUser = JSON.parse(sessionStorage.getItem("userDetails"));
let allUsers = JSON.parse(localStorage.getItem("AllRegisteredUsers"));
let LoggedInUserDetails = allUsers.find(
  (obj) => LoggedUser.email == obj.email
); //a obj
let productsInTheUserCart = LoggedInUserDetails.CartProducts; //give an array -->

<script>
  // if product aded in the cart show it in the cart

  // pre
  // let LoggedInUserDetails = JSON.parse(sessionStorage.getItem("userDetails"));
  // let productsInTheUserCart = LoggedInUserDetails.CartProducts;

  // new
  let LoggedUser = JSON.parse(sessionStorage.getItem("userDetails")); //from sessionStorage
  let allUsers = JSON.parse(localStorage.getItem("AllRegisteredUsers"));
  let LoggedInUserDetails = allUsers.find(
    (obj) => LoggedUser.email == obj.email
  ); //a obj
  let productsInTheUserCart = LoggedInUserDetails.CartProducts; //give an array

  // console.log("productsInTheUserCart", productsInTheUserCart);
  let BagEmptyPart = document.querySelector(".BagEmpty-Part");
  let BagNonEmptySection = document.querySelector(".BagNon-EmptySection");
  let StartShoppingButton = document.querySelector(".StartShopping");
  StartShoppingButton.addEventListener("click", function () {
    window.location.href = "/index.html";
  });

  let productsAndItsQuantityBOX = document.querySelector(
    ".products-And-ItsQuantity-BOX"
  );

  if (productsInTheUserCart && productsInTheUserCart.length > 0) {
    BagEmptyPart.style.display = "none";
    BagNonEmptySection.style.display = "block";

    // display number of product as per the productsInTheUserCartarray
    createProductBOX(productsInTheUserCart);
    function createProductBOX(productsInTheUserCart) {
      if (productsInTheUserCart.length === 0) {
        BagEmptyPart.style.display = "block";
        BagNonEmptySection.style.display = "none";

        return;
      }
      productsAndItsQuantityBOX.innerHTML = "";
      productsInTheUserCart.forEach((obj, i) => {
        let aProductDiv = document.createElement("div");
        aProductDiv.classList.add("products-And-ItsQuantity");
        aProductDiv.innerHTML = `
      <div class="img-nameDetails">
        <p>
          <img
            src=${obj.image}
            alt=""
          />
        </p>
        <div class="nameDetails">
          <h6>
            ${obj.productName}
            <span ><i class="fa-light fa-trash-can delete"  data-deleteindex=${i}></i></span>
          </h6>
          <p> ${obj.quantity}ml | ${obj.quantity}ml</p>
        </div>
      </div>
      <hr />
      <div class="qnt-price">
        <p>
          Quantity :
          <select  data-index=${i} name="${obj.productName}" data-prc="${
          obj.price
        }" class="quantitySelect">
            <option value="1" ${
              obj.numberOfProduct === 1 ? "selected" : ""
            }>1</option>
            <option value="2" ${
              obj.numberOfProduct === 2 ? "selected" : ""
            }>2</option>
            <option value="3" ${
              obj.numberOfProduct === 3 ? "selected" : ""
            }>3</option>
            <option value="4" ${
              obj.numberOfProduct === 4 ? "selected" : ""
            }>4</option>
            <option value="5" ${
              obj.numberOfProduct === 5 ? "selected" : ""
            }>5</option>
            <option value="6" ${
              obj.numberOfProduct === 6 ? "selected" : ""
            }>6</option>
          </select>
        </p>
        <p ><span class="previous-price">₹${
          obj.MRP * obj.numberOfProduct
        } </span> <b class="current-Price">₹${
          obj.price * obj.numberOfProduct
        }</b></p>
      </div>
      `;

        productsAndItsQuantityBOX.append(aProductDiv);
      });
    }

    //add  productDetails div in the PriceDetails container
    let PriceDetails = document.querySelector(".PriceDetails");

    PriceDetailsPART(productsInTheUserCart);
    function PriceDetailsPART(productsInTheUserCart) {
      PriceDetails.innerHTML = "";
      let totalItem = productsInTheUserCart.length;
      let totalPrice = productsInTheUserCart.reduce(
        (acc, nx) => acc + nx.price * nx.numberOfProduct,
        0
      );
      // totalsH2 -> you have to pay Grand Total
      let totalsH2 = document.querySelector(".totalsH2");
      totalsH2.innerText = `₹${totalPrice}`;

      PriceDetails.innerHTML = `
                                  <h2>Price Details</h2>
                                      <div>
                                        <p>Bag MRP (${totalItem} items)</p>
                                        <p>₹${totalPrice}</p>
                                      </div>
                                      <div>
                                        <p>Bag Discount</p>
                                        <p>₹322</p>
                                      </div>
                                      <div>
                                        <p>Shipping</p>
                                        <p>₹70 Free</p>
                                      </div>
                                      <div>
                                        <h2>You Pay</h2>
                                        <h2>₹${totalPrice}</h2>
                                      </div>`;
    }

    // quantitySelect
    let quantitySelect = document.querySelectorAll(".quantitySelect");

    quantitySelect.forEach((eachSelectTag, i) => {
      // give select tags  default value from the dom
      quantitySelect[i].value = productsInTheUserCart[i].numberOfProduct;

      //select tag quantity functionality
      eachSelectTag.addEventListener("change", changeFnOnSelect);
      function changeFnOnSelect(event) {
        let selectedValue = event.target.value;
        let SelectTAGIndex = event.target.dataset.index;
        let previousPrice = document.querySelectorAll(".previous-price");
        let currentPrice = document.querySelectorAll(".current-Price");

        // finding the Product object by its index and adding the selected quantity
        productsInTheUserCart[SelectTAGIndex].numberOfProduct =
          Number(selectedValue);
        // new
        LoggedInUserDetails = allUsers.find(
          (obj) => LoggedUser.email == obj.email
        ); //a obj
        LoggedInUserDetails.CartProducts = productsInTheUserCart;
        let index = allUsers.findIndex(
          (obj) => obj.id === LoggedInUserDetails.id
        );
        let newArray =
          index !== -1
            ? [
                ...allUsers.slice(0, index),
                LoggedInUserDetails, // Updated object
                ...allUsers.slice(index + 1),
              ]
            : allUsers;
        localStorage.setItem("AllRegisteredUsers", JSON.stringify(newArray));

        // pre
        // sessionStorage.setItem(
        //   "userDetails",
        //   JSON.stringify(LoggedInUserDetails)
        // );

        // pre
        // LoggedInUserDetails = JSON.parse(sessionStorage.getItem("userDetails"));
        // productsInTheUserCart = LoggedInUserDetails.CartProducts;

        allUsers = JSON.parse(localStorage.getItem("AllRegisteredUsers"));
        LoggedInUserDetails = allUsers.find(
          (obj) => LoggedUser.email == obj.email
        ); //a obj
        productsInTheUserCart = LoggedInUserDetails.CartProducts; //give an array

        // changing the productdetail's price as we select quantity
        currentPrice[i].innerText = "";
        currentPrice[i].innerText =
          productsInTheUserCart[i].numberOfProduct *
          productsInTheUserCart[i].price;
        // changing the productdetail's MRP as we select quantity
        previousPrice[i].innerText = "";
        previousPrice[i].innerText =
          productsInTheUserCart[i].numberOfProduct *
          productsInTheUserCart[i].MRP;
        PriceDetailsPART(productsInTheUserCart);
      }
    });

    // every thing working till adding products and qut. update

    delete functionality;
    document
      .querySelector(".products-And-ItsQuantity-BOX")
      .addEventListener("click", function (e) {
        if (e.target && e.target.classList.contains("delete")) {
          let clickedIndex = e.target.dataset.deleteindex;
          console.log("clickedIndex-", clickedIndex);

          // pre
          // LoggedInUserDetails = JSON.parse(
          //   sessionStorage.getItem("userDetails")
          // );
          // productsInTheUserCart = LoggedInUserDetails.CartProducts;

          // new
          allUsers = JSON.parse(localStorage.getItem("AllRegisteredUsers"));
          LoggedInUserDetails = allUsers.find(
            (obj) => LoggedUser.email == obj.email
          ); //a obj
          productsInTheUserCart = LoggedInUserDetails.CartProducts; //give an array

          let newArrayAfterDeleting = productsInTheUserCart.filter(
            (obj, index) => index !== +clickedIndex
          );

          // new
          //  console.log("newArray-", newArrayAfterDeleting);
          LoggedInUserDetails.CartProducts = newArrayAfterDeleting;

          index = allUsers.findIndex(
            (obj) => obj.id === LoggedInUserDetails.id
          );

          newArray =
            index !== -1
              ? [
                  ...allUsers.slice(0, index),
                  LoggedInUserDetails, // Updated object
                  ...allUsers.slice(index + 1),
                ]
              : allUsers;
          localStorage.setItem("AllRegisteredUsers", JSON.stringify(newArray));

          //pre
          // sessionStorage.setItem(
          //   "userDetails",
          //   JSON.stringify(LoggedInUserDetails)
          // );

          //pre
          // LoggedInUserDetails = JSON.parse(
          //   sessionStorage.getItem("userDetails")
          // );
          // productsInTheUserCart = LoggedInUserDetails.CartProducts;

          // new
          allUsers = JSON.parse(localStorage.getItem("AllRegisteredUsers"));
          LoggedInUserDetails = allUsers.find(
            (obj) => LoggedUser.email == obj.email
          ); //a obj
          productsInTheUserCart = LoggedInUserDetails.CartProducts;

          createProductBOX(productsInTheUserCart);
          PriceDetailsPART(productsInTheUserCart);
        }
      });

    document
      .querySelector(".orderPlaced")
      .addEventListener("click", orderPlaced);
    function orderPlaced() {
      // LoggedInUserDetails = JSON.parse(sessionStorage.getItem("userDetails"));
      // LoggedInUserDetails.CartProducts = [];
      // sessionStorage.setItem(
      //   "userDetails",
      //   JSON.stringify(LoggedInUserDetails)
      // );

      allUsers = JSON.parse(localStorage.getItem("AllRegisteredUsers"));
      LoggedInUserDetails = allUsers.find(
        (obj) => LoggedUser.email == obj.email
      ); //a obj

      LoggedInUserDetails.CartProducts = [];

      index = allUsers.findIndex((obj) => obj.id === LoggedInUserDetails.id);

      newArray =
        index !== -1
          ? [
              ...allUsers.slice(0, index),
              LoggedInUserDetails, // Updated object
              ...allUsers.slice(index + 1),
            ]
          : allUsers;
      localStorage.setItem("AllRegisteredUsers", JSON.stringify(newArray));

           window.location.href = "/pages/orderPlacedSuccessfully/orderPlaced.html";
    }
  }
</script>
